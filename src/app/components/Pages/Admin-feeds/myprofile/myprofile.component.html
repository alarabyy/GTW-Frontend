<div class="container py-5">
  <div class="card shadow-lg p-4 mx-auto" style="max-width: 600px;">
    <div class="text-center mb-4">
      <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png"
           class="rounded-circle border border-3 border-primary"
           width="120" height="120" alt="User Avatar">
      <h3 class="mt-3 text-primary fw-bold">{{ userForm.value.name || 'User Name' }}</h3>
      <p class="text-muted">&#64;{{ userForm.value.name || 'username' }}</p>
    </div>

    <hr>

    <!-- Alerts -->
    <div *ngIf="successMsg" class="alert alert-success">{{ successMsg }}</div>
    <div *ngIf="errorMsg" class="alert alert-danger">{{ errorMsg }}</div>

    <!-- Profile Update Form -->
    <form [formGroup]="userForm" (ngSubmit)="updateProfile()">
      <div class="mb-3">
        <label for="name" class="form-label"><strong>Name</strong></label>
        <input id="name" type="text" class="form-control" formControlName="name">
        <div *ngIf="userForm.get('name')?.invalid && userForm.get('name')?.touched" class="text-danger">
          Name is required.
        </div>
      </div>

      <div class="mb-3">
        <label for="email" class="form-label"><strong>Email</strong></label>
        <input id="email" type="email" class="form-control" formControlName="email">
        <div *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.touched" class="text-danger">
          Enter a valid email.
        </div>
      </div>

      <button type="submit" class="btn btn-primary w-100 mb-2" [disabled]="loading || userForm.invalid">
        {{ loading ? 'Updating...' : 'Update Profile' }}
      </button>
    </form>

    <hr>

    <!-- Password Update -->
    <button class="btn btn-warning w-100 mb-3" (click)="togglePasswordForm()">
      {{ showPasswordForm ? 'Cancel Password Change' : 'Change Password' }}
    </button>

    <div *ngIf="showPasswordForm">
      <div *ngIf="pwdSuccessMsg" class="alert alert-success">{{ pwdSuccessMsg }}</div>
      <div *ngIf="pwdErrorMsg" class="alert alert-danger">{{ pwdErrorMsg }}</div>

      <form [formGroup]="passwordForm" (ngSubmit)="updatePassword()">
        <div class="mb-3">
          <label for="password" class="form-label"><strong>New Password</strong></label>
          <input id="password" type="password" class="form-control" formControlName="password">
          <div *ngIf="passwordForm.get('password')?.invalid && passwordForm.get('password')?.touched" class="text-danger">
            Password must be at least 6 characters.
          </div>
        </div>

        <div class="mb-3">
          <label for="confirmPassword" class="form-label"><strong>Confirm Password</strong></label>
          <input id="confirmPassword" type="password" class="form-control" formControlName="confirmPassword">
<div *ngIf="passwordForm.errors?.['mismatch'] && passwordForm.get('confirmPassword')?.touched" class="text-danger">
  Passwords do not match.
</div>

        </div>

        <button type="submit" class="btn btn-warning w-100" [disabled]="pwdLoading || passwordForm.invalid">
          {{ pwdLoading ? 'Updating...' : 'Update Password' }}
        </button>
      </form>
    </div>
  </div>
</div>
